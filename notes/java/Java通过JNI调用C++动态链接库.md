# Java通过JNI调用C++动态链接库



## 1、编写Java文件

```java
package com.zync.jni.api;

public class MtkUsbJNI {
    public native int scanDevice();
}



package com.zync.jni.api;

public class MtkUsb {
    private final static MtkUsb mtkUsb = new MtkUsb();

    private MtkUsb() {}

    public static MtkUsb getInstant() {
        return mtkUsb;
    }

    private final MtkUsbJNI mtkUsbJNI = new MtkUsbJNI();

    public int scanDevice() {
        return mtkUsbJNI.scanDevice();
    }
}



package com.zync.jni.test;

import com.zync.jni.api.MtkUsb;

public class MktHidUstTest {
    public static void main(String[] args) {
        System.out.println(System.getProperty("java.library.path"));
        System.loadLibrary("LinuxHidUsb");

        System.out.println("Device count = " + MtkUsb.getInstant().scanDevice());
    }
}
```



## 2、由java代码生成JNI C头文件

```shell
javah -jni -encoding UTF-8 com.zync.jni.api.MtkUsbJNI
```

## 3、执行2会生成 `com_zync_jni_api_MtkUsbJNI.h` 这个文件，内容如下

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_zync_jni_api_MtkUsbJNI */

#ifndef _Included_com_zync_jni_api_MtkUsbJNI
#define _Included_com_zync_jni_api_MtkUsbJNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_zync_jni_api_MtkUsbJNI
 * Method:    scanDevice
 * Signature: ()I
 */
JNIEXPORT jint JNICALL Java_com_zync_jni_api_MtkUsbJNI_scanDevice
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

```



## 4、编写c++实现类 `LinuxHidUsb.cpp`

```c++
#include "com_zync_jni_api_MtkUsbJNI.h"

JNIEXPORT jint JNICALL Java_com_zync_jni_api_MtkUsbJNI_scanDevice(JNIEnv *, jobject)
{
    return 1;
}
```



## 5、编译c++代码生成动态库

- g++编译方式

```shell
mac:

g++ -fPIC -shared -o libLinuxHidUsb.dylib src/LinuxHidUsb.cpp -Iinclude -I/Library/Java/JavaVirtualMachines/jdk1.8.0_291.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/jdk1.8.0_291.jdk/Contents/Home/include/darwin


linux:

g++ -fPIC -shared -o libLinuxHidUsb.so src/LinuxHidUsb.cpp -Iinclude -I/usr/local/jdk1.8.0_202/include -I/usr/local/jdk1.8.0_202/include/linux

```

- cmake编译方式

```
```

